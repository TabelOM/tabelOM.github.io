<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Tabel Kalkulasi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.container {
  position: relative;
  width: 100%;
  height: 100vh;
}

iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* RUNNING TEXT */
#running-text {
  position: absolute;
  top: 0;
  width: 100%;
  height: 25px;
  z-index: 10000;
  pointer-events: none;
}

.running-inner-bar {
  height: 100%;
  margin: 0 250px;
  background: rgba(18, 52, 88, 0.85);
  overflow: hidden;
  mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
}

.running-inner {
  margin: 0 10px;
  overflow: hidden;
}

#running-text span {
  display: inline-block;
  white-space: nowrap;
  padding-left: 100%;
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
  animation: marquee 20s linear infinite;
}

@keyframes marquee {
  from { transform: translateX(0); }
  to   { transform: translateX(-100%); }
}

/* JAM */
#digital-clock {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  background: #123458;
  color: white;
  padding: 8px 26px;
  font-weight: bold;
  font-size: 1.1rem;
  border-radius: 0 0 12px 12px;
  cursor: pointer;
}

/* MODAL */
.rt-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  z-index: 20000;
}

.rt-box {
  background: #fff;
  width: 90%;
  max-width: 520px;
  margin: 80px auto;
  padding: 15px;
  border-radius: 10px;
}

#rt-input {
  width: 100%;
  height: 80px;
  resize: none;
}

.char-count {
  text-align: right;
  font-size: 0.85rem;
  color: #666;
}

.rt-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

#rt-list {
  list-style: none;
  padding: 0;
  margin-top: 10px;
}

#rt-list li {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 4px;
  border-bottom: 1px solid #ddd;
}

/* TEKS SEBARIS */
.rt-text {
  flex: 1;
  cursor: pointer;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.95rem;
}

/* HAPUS */
.delete-btn {
  flex: 0 0 32px;
  text-align: center;
  cursor: pointer;
  color: #c00;
  font-size: 1.1rem;
  user-select: none;
}

.delete-btn:hover {
  background: #ffecec;
  border-radius: 6px;
}
</style>
</head>

<body>

<div class="container">

  <!-- RUNNING TEXT -->
  <div id="running-text">
    <div class="running-inner-bar">
      <div class="running-inner">
        <span id="running-content">Loading...</span>
      </div>
    </div>
  </div>

  <!-- JAM -->
  <div id="digital-clock">00:00:00</div>

  <!-- IFRAME -->
  <iframe src="https://www.appsheet.com/start/1474754a-c8a9-4660-aeef-d197abcbdf76?platform=mobile#appName=TabelKalkulasiV1-761441667&view=Dashboard"></iframe>

</div>

<!-- MODAL -->
<div id="rt-modal" class="rt-modal">
  <div class="rt-box">
    <h3>üìù Kelola Running Text</h3>

    <textarea id="rt-input" maxlength="120" placeholder="Maksimal 120 karakter"></textarea>
    <div class="char-count">
      <span id="charCount">0</span> / 120
    </div>

    <div class="rt-buttons">
      <button onclick="saveText()">üíæ Simpan</button>
      <button onclick="closeModal()">‚ùå Tutup</button>
    </div>

    <ul id="rt-list"></ul>
  </div>
</div>

<script>
/* JAM */
function updateClock() {
  document.getElementById("digital-clock")
    .innerText = new Date().toLocaleTimeString("id-ID");
}
setInterval(updateClock, 1000);
updateClock();

/* STORAGE */
const STORAGE_KEY = "RUNNING_TEXT_DATA";
const MAX_CHAR = 120;

/* LOAD */
let messages = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
  "üî• Flash Point ‚Äì Titik suhu saat bahan bakar mulai menguap",
  "‚õΩ Cetane Number ‚Äì Kualitas pembakaran diesel"
];

let editIndex = null;

/* SAVE STORAGE */
function saveStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
}

/* RUNNING TEXT */
function updateRunningText() {
  if (!messages.length) return;

  const span = document.getElementById("running-content");
  const text = messages[Math.floor(Math.random() * messages.length)];

  span.style.animation = "none";
  span.offsetHeight;
  span.textContent = text;
  span.style.animation = "marquee 20s linear infinite";
}
updateRunningText();
setInterval(updateRunningText, 15000);

/* MODAL */
document.getElementById("digital-clock").onclick = openModal;

function openModal() {
  document.getElementById("rt-modal").style.display = "block";
  renderList();
  updateCounter();
}

function closeModal() {
  document.getElementById("rt-modal").style.display = "none";
  document.getElementById("rt-input").value = "";
  editIndex = null;
  updateCounter();
}

/* LIST */
function renderList() {
  const ul = document.getElementById("rt-list");
  ul.innerHTML = "";

  messages.forEach((msg, i) => {
    const li = document.createElement("li");

    const text = document.createElement("div");
    text.className = "rt-text";
    text.textContent = msg;
    text.title = msg;
    text.onclick = () => editText(i);

    const del = document.createElement("div");
    del.className = "delete-btn";
    del.textContent = "üóëÔ∏è";
    del.onclick = (e) => {
      e.stopPropagation();
      deleteText(i);
    };

    li.appendChild(text);
    li.appendChild(del);
    ul.appendChild(li);
  });
}

/* EDIT */
function editText(index) {
  document.getElementById("rt-input").value = messages[index];
  editIndex = index;
  updateCounter();
}

/* DELETE */
function deleteText(index) {
  if (!confirm("Hapus running text ini?")) return;
  messages.splice(index, 1);
  saveStorage();
  renderList();
}

/* SAVE */
function saveText() {
  const val = document.getElementById("rt-input").value.trim();
  if (!val) return;

  if (val.length > MAX_CHAR) {
    alert("Teks terlalu panjang!");
    return;
  }

  if (editIndex !== null) {
    messages[editIndex] = val;
  } else {
    messages.push(val);
  }

  saveStorage();
  renderList();
  document.getElementById("rt-input").value = "";
  editIndex = null;
  updateCounter();
}

/* COUNTER */
const input = document.getElementById("rt-input");
const counter = document.getElementById("charCount");

function updateCounter() {
  counter.innerText = input.value.length;
}

input.addEventListener("input", updateCounter);
</script>

</body>
</html>
